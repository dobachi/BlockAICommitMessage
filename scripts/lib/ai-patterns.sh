#!/bin/bash

# AIã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©
# æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸­å¤®ç®¡ç†

# AIç½²åãƒ‘ã‚¿ãƒ¼ãƒ³
declare -a AI_SIGNATURES=(
    "ğŸ¤–"
    "ğŸ¤– Generated with"
    "Co-Authored-By: Claude"
    "Co-Authored-By: GPT"
    "Co-Authored-By: Gemini"
    "Co-Authored-By: Copilot"
    "Co-Authored-By: Bard"
    "Generated by AI"
    "AI-generated"
    "Auto-generated by"
    "Automatically generated"
    "[AI]"
    "[Bot]"
    "[AUTO]"
    "noreply@anthropic.com"
    "noreply@openai.com"
    "noreply@github.com"
    "claude.ai"
    "openai.com"
)

# AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ­£è¦è¡¨ç¾ï¼‰
declare -a AI_STRUCTURAL_PATTERNS=(
    # Conventional Commitså½¢å¼ã®éåº¦ãªä½¿ç”¨
    "^(feat|fix|docs|style|refactor|test|chore|perf|build|ci)(\([a-zA-Z0-9_-]+\))?: [A-Z][a-z]+ .+"
    
    # å…¸å‹çš„ãªAIèª¬æ˜ãƒ‘ã‚¿ãƒ¼ãƒ³
    "^This (commit|change|update|patch) .+"
    "^Update.* to .* for .+"
    "^Refactor.* to improve .+"
    "^Implement.* functionality for .+"
    "^Add.* support for .+"
    "^Fix.* issue with .+"
    "^Enhance.* by .+"
    "^Optimize.* for better .+"
    
    # ç®‡æ¡æ›¸ããƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ3ã¤ä»¥ä¸Šã®é …ç›®ï¼‰
    "^- .+\n- .+\n- .+"
    "^\\* .+\n\\* .+\n\\* .+"
    "^[0-9]\. .+\n[0-9]\. .+\n[0-9]\. .+"
)

# å½¢å¼çš„ãªèªå½™ãƒªã‚¹ãƒˆ
declare -a FORMAL_VOCABULARY=(
    "enhance"
    "optimize"
    "streamline"
    "implement"
    "incorporate"
    "facilitate"
    "utilize"
    "leverage"
    "establish"
    "ensure"
    "maintain"
    "provide"
    "enable"
    "configure"
    "integrate"
    "consolidate"
    "standardize"
    "modernize"
    "restructure"
    "ameliorate"
)

# AIãƒ„ãƒ¼ãƒ«ç‰¹æœ‰ã®ãƒ•ãƒ¬ãƒ¼ã‚º
declare -a AI_SPECIFIC_PHRASES=(
    "for better maintainability"
    "to improve readability"
    "for enhanced performance"
    "to ensure consistency"
    "following best practices"
    "adhering to standards"
    "in accordance with"
    "as per requirements"
    "to facilitate future"
    "for optimal results"
)

# æ¤œå‡ºã‚¹ã‚³ã‚¢ã®é‡ã¿ä»˜ã‘
declare -A DETECTION_WEIGHTS=(
    ["signature"]=100        # AIç½²åï¼ˆå³åº§ã«æ¤œå‡ºï¼‰
    ["structural"]=50        # æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³
    ["vocabulary"]=20        # å½¢å¼çš„èªå½™
    ["phrase"]=30           # AIç‰¹æœ‰ãƒ•ãƒ¬ãƒ¼ã‚º
    ["grammar"]=15          # æ–‡æ³•çš„å®Œç’§ã•
    ["list"]=25             # ç®‡æ¡æ›¸ãå½¢å¼
)

# æ¤œå‡ºé–¾å€¤
DETECTION_THRESHOLD=80

# ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°é–¢æ•°
matches_pattern() {
    local text="$1"
    local pattern="$2"
    
    # Perlæ­£è¦è¡¨ç¾ãŒä½¿ãˆã‚‹å ´åˆã¯ä½¿ç”¨ã€ãã†ã§ãªã‘ã‚Œã°åŸºæœ¬çš„ãªæ­£è¦è¡¨ç¾
    if command -v perl >/dev/null 2>&1; then
        echo "$text" | perl -ne "exit 0 if /$pattern/; exit 1" 2>/dev/null
    else
        echo "$text" | grep -Eq "$pattern" 2>/dev/null
    fi
    
    return $?
}

# å½¢å¼çš„èªå½™ã®ã‚«ã‚¦ãƒ³ãƒˆé–¢æ•°
count_formal_words() {
    local text="$1"
    local count=0
    
    for word in "${FORMAL_VOCABULARY[@]}"; do
        local word_count=$(echo "$text" | grep -io "$word" | wc -l)
        count=$((count + word_count))
    done
    
    echo $count
}

# AIç‰¹æœ‰ãƒ•ãƒ¬ãƒ¼ã‚ºã®æ¤œå‡ºé–¢æ•°
detect_ai_phrases() {
    local text="$1"
    local found=0
    
    for phrase in "${AI_SPECIFIC_PHRASES[@]}"; do
        if echo "$text" | grep -qi "$phrase"; then
            found=$((found + 1))
        fi
    done
    
    echo $found
}